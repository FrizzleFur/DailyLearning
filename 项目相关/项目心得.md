# é¡¹ç›®å¿ƒå¾—


## OCä¸­å¤šå‚æ•°çš„æ–¹æ³•

å½“ä¸€ä¸ªæ–¹æ³•æ¶‰åŠåˆ°ä¸ç¡®å®šå¤šå‚æ•°çš„è®¾ç½®å’Œä½¿ç”¨æ—¶ï¼Œå¯ä»¥ç”¨ä¸‹é¢æ–¹å¼


```objc
+ (instancetype)qmui_arrayWithObjects:(id)object, ... {
    void (^addObjectToArrayBlock)(NSMutableArray *array, id obj) = ^void(NSMutableArray *array, id obj) {
        if ([obj isKindOfClass:[NSArray class]]) {
            [array addObjectsFromArray:obj];
        } else {
            [array addObject:obj];
        }
    };
    
    NSMutableArray *result = [[NSMutableArray alloc] init];
    addObjectToArrayBlock(result, object);
        va_list argumentList; //å®šä¹‰ä¸€ä¸ª va_list æŒ‡é’ˆæ¥è®¿é—®å‚æ•°è¡¨  
    va_start(argumentList, object);//åˆå§‹åŒ– va_listï¼Œè®©å®ƒæŒ‡å‘ç¬¬ä¸€ä¸ªå˜å‚ï¼Œ
       id argument;
    while ((argument = va_arg(argumentList, id))) {//è°ƒç”¨ va_arg ä¾æ¬¡å–å‡º å‚æ•°ï¼Œå®ƒä¼šè‡ªå¸¦æŒ‡å‘ä¸‹ä¸€ä¸ªå‚æ•°  
        addObjectToArrayBlock(result, argument);
    }
    va_end(argumentList);// æ”¶å°¾ï¼Œè®°å¾—å…³é—­å…³é—­ va_list  
    if ([self isKindOfClass:[NSMutableArray class]]) {
        return result;
    }
    return result.copy;
}

```


ï¼ˆ1ï¼‰é¦–å…ˆåœ¨å‡½æ•°é‡Œå®šä¹‰ä¸€å…·VA_LISTå‹çš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯æŒ‡å‘å‚æ•°çš„æŒ‡é’ˆï¼›
ï¼ˆ2ï¼‰ç„¶åç”¨VA_STARTå®åˆå§‹åŒ–åˆšå®šä¹‰çš„VA_LISTå˜é‡ï¼›
ï¼ˆ3ï¼‰ç„¶åç”¨VA_ARGè¿”å›å¯å˜çš„å‚æ•°ï¼ŒVA_ARGçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä½ è¦è¿”å›çš„å‚æ•°çš„ç±»å‹ï¼ˆå¦‚æœå‡½æ•°æœ‰å¤šä¸ªå¯å˜å‚æ•°çš„ï¼Œä¾æ¬¡è°ƒç”¨VA_ARGè·å–å„ä¸ªå‚æ•°ï¼‰ï¼›
ï¼ˆ4ï¼‰æœ€åç”¨VA_ENDå®ç»“æŸå¯å˜å‚æ•°çš„è·å–ã€‚
æ³¨æ„ï¼š

ï¼ˆ1ï¼‰å¯å˜å‚æ•°çš„ç±»å‹å’Œä¸ªæ•°å®Œå…¨ç”±ç¨‹åºä»£ç æ§åˆ¶,å®ƒå¹¶ä¸èƒ½æ™ºèƒ½åœ°è¯†åˆ«ä¸åŒå‚æ•°çš„ä¸ªæ•°å’Œç±»å‹ï¼›
ï¼ˆ2ï¼‰å¦‚æœæˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸€è¯¦è§£æ¯ä¸ªå‚æ•°ï¼Œåªéœ€è¦å°†å¯å˜åˆ—è¡¨æ‹·è´è‡³æŸä¸ªç¼“å†²ï¼Œå¯ç”¨vsprintfå‡½æ•°ï¼›
ï¼ˆ3ï¼‰å› ä¸ºç¼–è¯‘å™¨å¯¹å¯å˜å‚æ•°çš„å‡½æ•°çš„åŸå‹æ£€æŸ¥ä¸å¤Ÿä¸¥æ ¼,å¯¹ç¼–ç¨‹æŸ¥é”™ä¸åˆ©.ä¸åˆ©äºæˆ‘ä»¬å†™å‡ºé«˜è´¨é‡çš„ä»£ç ï¼›


[iOSè‡ªå®šä¹‰å¤šå‚æ•°ç±»å‹æ–¹æ³• - ç‹å°èˆª - åšå®¢å›­](https://www.cnblogs.com/wanghang/p/6298878.html)


# APP

## å¤šä¸ªå¯¹è±¡æ‰§è¡Œæ–¹æ³•

```objc

/**
 ç§»é™¤å½“å‰æ‰€æœ‰ subviews
 */
- (void)qmui_removeAllSubviews;

- (void)qmui_removeAllSubviews {
    [self.subviews makeObjectsPerformSelector:@selector(removeFromSuperview)];
}

```



## AppDelegateå¯åŠ¨ä¸šåŠ¡é€»è¾‘æ¨¡å—åŒ–

![](https://pic-mike.oss-cn-hongkong.aliyuncs.com/Blog/20190305183550.png)

```objc

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    //åˆå§‹åŒ–window
    [self initWindow];
    
    //åˆå§‹åŒ–ç½‘ç»œè¯·æ±‚é…ç½®
    [self NetWorkConfig];
    
    //UMengåˆå§‹åŒ–
    [self initUMeng];
    
    //åˆå§‹åŒ–appæœåŠ¡
    [self initService];
    
    //åˆå§‹åŒ–IM
    [[IMManager sharedIMManager] initIM];
    
    //åˆå§‹åŒ–ç”¨æˆ·ç³»ç»Ÿ
    [self initUserManager];
    
    //ç½‘ç»œç›‘å¬
    [self monitorNetworkStatus];
    
    //å¹¿å‘Šé¡µ
    [AppManager appStart];
    
    return YES;
}
```



## å¿«é€Ÿåˆå§‹åŒ–

* å¯å˜æ•°ç»„å¿«é€Ÿåˆå§‹åŒ–

```objc
@property (nonatomic,strong) NSMutableArray * dataArray;//æ•°æ®æº
_dataArray = @[].mutableCopy;

```



# UI

## å¯¼èˆªçš„æ‡’åŠ è½½

ä¸€ç§æ ¼æ ¼å®¶çš„é¦–é¡µæ‡’åŠ è½½æ€è·¯ï¼š

* æ¯ä¸ªå­é¡µé¢æ·»åŠ MJçš„ä¸‹æ‹‰åˆ·æ–°ï¼Œåœ¨åˆå§‹åŒ–é¡µé¢çš„æ—¶å€™è°ƒç”¨`MJRefresh`çš„`beginRefreshing`æ–¹æ³•å®ç°è¯·æ±‚APIã€‚
* åœ¨æ¯ä¸ªå­é¡µé¢åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå› ä¸ºè¿˜æœªæ˜¾ç¤º`MJRefresh`,æ‰€ä»¥`beginRefreshing`æ— æ³•ç«‹å³æ‰§è¡Œï¼›
* å½“ç‚¹å‡»tabarå±•ç¤ºå¯¹åº”çš„è‡ªæ§åˆ¶å™¨çš„viewçš„æ—¶ï¼Œå°±ä¼šè°ƒç”¨`beginRefreshing`ï¼Œä»è€Œå®ç°æ‡’åŠ è½½


### çˆ¶å­æ§åˆ¶å™¨

![](https://i.loli.net/2018/11/01/5bda6e1f95c7b.jpg)

å‘ç°åœ¨çˆ¶å­æ§åˆ¶å™¨å±‚çº§ä¸­ï¼ŒviewWillAppear  viewDidAppearçš„é¡ºåºæ˜¯

* çˆ¶æ§åˆ¶å™¨-viewWillAppear
* å­æ§åˆ¶å™¨-viewWillAppear
* å­æ§åˆ¶å™¨-viewDidAppear
* çˆ¶æ§åˆ¶å™¨-viewDidAppear

![](https://i.loli.net/2018/11/01/5bda6d5712fd0.jpg)
![](https://i.loli.net/2018/11/01/5bda6d752be2f.jpg)

![](https://i.loli.net/2018/11/01/5bda6d4b26216.jpg)

ä¹Ÿå°±æ˜¯è¯´çˆ¶æ§åˆ¶å™¨å…ˆåˆå§‹åŒ–ï¼Œä¼šç­‰å…¶å­æ§åˆ¶å®Œå…¨æ˜¾ç¤ºåå†è°ƒç”¨viewDidAppearæ–¹æ³•



## UITableCellå±•å¼€ï¼Œåˆ·æ–°é—ªçƒ

![](https://pic-mike.oss-cn-hongkong.aliyuncs.com/Blog/20190227113730.png)

**æ³¨æ„cellçš„subviewå¦‚æœåŠ åœ¨cellçš„contentViewä¸Šä¼šæœ‰é—ªçƒ**ã€‚

```objc
[tableView beginUpdates];
[tableView reloadRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationNone];
[tableView endUpdates];
```

cellåˆ·æ–°ä¼šè°ƒ`layoutSubviews`ï¼Œè¿™é‡Œå¦‚æœå†å»è°ƒç”¨`setNeedsLayout` ==> å†æ¬¡è°ƒ`layoutSubviews`,ç›¸å½“äºè°ƒç”¨äº†2æ¬¡å¸ƒå±€


```objc
- (void)setCommentsModel:(CommentsModel *)commentsModel{
    //æ·»åŠ ç‚¹èµæƒ…å†µ
    if (_commentsModel != commentsModel) {
        _commentsModel = commentsModel;
    }
    /** update cell */
 [self setNeedsLayout];
}
```

æ‰€ä»¥åº”è¯¥æ›´æ–°é€»è¾‘æ”¾åœ¨modelå˜åŒ–æ—¶çš„é‡Œé¢è°ƒç”¨

```objc
- (void)setCommentsModel:(CommentsModel *)commentsModel{
    //æ·»åŠ ç‚¹èµæƒ…å†µ
    if (_commentsModel != commentsModel) {
        _commentsModel = commentsModel;
     /** update cell */
     [self setNeedsLayout];

    }
}
```



## å¯¼èˆªè½¬åœºåŠ¨ç”»

ä¹‹å‰åœ¨åŸºç±»å¯¼èˆªæ§åˆ¶å™¨ä¸­å°è£…äº†è½¬åœºåŠ¨ç”»ï¼Œä½†æ˜¯è¿™å—çš„åˆ¤æ–­æ¡ä»¶æ˜¯æ‹¿é‚£äº›VCæ¥åšåˆ¤æ–­ï¼š


```objc

- (PushTransition *)pushAnimation{
    if (!_pushAnimation) {
        _pushAnimation = [[PushTransition alloc] init];
    }
    return _pushAnimation;
}

- (PopTransition *)popAnimation{
    if (!_popAnimation) {
        _popAnimation = [[PopTransition alloc] init];
    }
    return _popAnimation;
}

- (id<UIViewControllerAnimatedTransitioning>)navigationController:(UINavigationController *)navigationController
                                  animationControllerForOperation:(UINavigationControllerOperation)operation
                                               fromViewController:(UIViewController *)fromVC
                                                 toViewController:(UIViewController *)toVC{
    if ([fromVC isMemberOfClass:GetClass(PostDetailVC)] && [toVC isMemberOfClass:GetClass(PostDetailVC)]) {
        if (operation == UINavigationControllerOperationPush) {
            return self.pushAnimation;
        }else if (operation == UINavigationControllerOperationPop){
            return self.popAnimation;
        }
    }
    return nil;
}

```


ç„¶åhook å¯¼èˆªçš„è¿”å›äº‹ä»¶

```objc
- (void)back {
    
    UIViewController *topViewController = [self topViewController];
    BaseTabBarController *tabBarController = [AppDelegate sharedAppDelegate].baseTabController;
 if ([topViewController isMemberOfClass:[PostDetailVC class]]){
        /* åŠ¨æ€è¯¦æƒ… */
        [self.viewControllers enumerateObjectsWithOptions:NSEnumerationReverse usingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
            if (![obj isMemberOfClass:GetClass(PostDetailVC)]) {
                *stop = YES;
                [self popToViewController:obj animated:YES];
            }
        }];
        return;
    }
    
    [self popViewControllerAnimated:YES];
}

```


ç„¶åå‘ç°æœ‰äººå°è£…äº†ä¸€ç§åè®®çš„æ–¹æ³•æ¥å®ç°é‚£äº›VCå®ç°ï¼Œå°±åˆ¤æ–­éµå¾ªåè®®çš„VCå®ç°è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»å°±å¯ä»¥ï¼Œç§’!ğŸ‘

```objc
//navigationåˆ‡æ¢æ˜¯ä¼šèµ°è¿™ä¸ªä»£ç†
-(id<UIViewControllerAnimatedTransitioning>)navigationController:(UINavigationController *)navigationController animationControllerForOperation:(UINavigationControllerOperation)operation fromViewController:(UIViewController *)fromVC toViewController:(UIViewController *)toVC
{
    NSLog(@"è½¬åœºåŠ¨ç”»ä»£ç†æ–¹æ³•");
    self.isSystemSlidBack = YES;
    //å¦‚æœæ¥æºVCå’Œç›®æ ‡VCéƒ½å®ç°åè®®ï¼Œé‚£ä¹ˆéƒ½åšåŠ¨ç”»
    if ([fromVC conformsToProtocol:@protocol(XYTransitionProtocol)] && [toVC conformsToProtocol:@protocol(XYTransitionProtocol)]) {
        
        BOOL pinterestNedd = [self isNeedTransition:fromVC:toVC];
        XYTransition *transion = [XYTransition new];
        if (operation == UINavigationControllerOperationPush && pinterestNedd) {
            transion.isPush = YES;
            
            //æš‚æ—¶å±è”½å¸¦åŠ¨ç”»çš„å³åˆ’è¿”å›
            self.isSystemSlidBack = NO;
            //            self.isSystemSlidBack = YES;
        }
        else if(operation == UINavigationControllerOperationPop && pinterestNedd)
        {
            //æš‚æ—¶å±è”½å¸¦åŠ¨ç”»çš„å³åˆ’è¿”å›
            //            return nil;
            
            transion.isPush = NO;
            self.isSystemSlidBack = NO;
        }
        else{
            return nil;
        }
        return transion;
    }else if([toVC conformsToProtocol:@protocol(XYTransitionProtocol)]){
        //å¦‚æœåªæœ‰ç›®æ ‡VCå¼€å¯åŠ¨ç”»ï¼Œé‚£ä¹ˆisSystemSlidBackä¹Ÿè¦éšä¹‹æ”¹å˜
        BOOL pinterestNedd = [self isNeedTransition:toVC];
        self.isSystemSlidBack = !pinterestNedd;
        return nil;
    }
    return nil;
}

```

åŒæ—¶ä¹Ÿå­¦åˆ°äº†ä¸€ç§è½¬åœºåŠ¨ç”»

// An object that drives an interactive animation between one view controller and another.
* UIPercentDrivenInteractiveTransition *interactivePopTransition



# APIè¯·æ±‚

å‘ç°ç½‘ç»œè¯·æ±‚å¯ä»¥å§æ•°æ®è§£æç•™åœ¨Modelä¸­ï¼Œç»“åˆ`YYModel`,å¯ä»¥å°†æ›´å°‘çš„ä»£ç å†™å…¥ã€‚

```objc
/**
 *  è¿”å›resultä¸‹item_list æ•°ç»„æ¨¡å‹
 *
 *  @param url          è¯·æ±‚åœ°å€
 *  @param param        è¯·æ±‚å‚æ•°
 *  @param resultClass  éœ€è¦è½¬æ¢è¿”å›çš„æ•°æ®æ¨¡å‹
 *  @param success      è¯·æ±‚æˆåŠŸåçš„å›è°ƒï¼ˆè¯·å°†è¯·æ±‚æˆåŠŸåæƒ³åšçš„äº‹æƒ…å†™åˆ°è¿™ä¸ªblockä¸­ï¼‰
 *  @param warn         è¯·æ±‚å¤±è´¥åè­¦å‘Šæç¤ºè¯­ï¼ˆæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç›´æ¥å¼¹å‡ºæ˜¾ç¤ºå³å¯ï¼‰
 *  @param failure      è¯·æ±‚å¤±è´¥åçš„å›è°ƒï¼ˆè¯·å°†è¯·æ±‚å¤±è´¥åæƒ³åšçš„äº‹æƒ…å†™åˆ°è¿™ä¸ªblockä¸­ï¼‰
 *  @param tokenInvalid tokenè¿‡æœŸåçš„å›è°ƒï¼ˆè¯·å°†tokenåæƒ³åšçš„äº‹æƒ…å†™åˆ°è¿™ä¸ªblockä¸­ï¼‰
 */
+ (void)postItemListWithUrl:(NSString *)url param:(id)param
                resultClass:(Class)resultClass
                    success:(void (^)(id result))success
                       warn:(void (^)(NSString *warnMsg))warn
                    failure:(void (^)(NSError *error))failure
               tokenInvalid:(void (^)())tokenInvalid;


/**
 *  è¿”å›result æ•°æ®æ¨¡å‹
 *
 *  @param url          è¯·æ±‚åœ°å€
 *  @param param        è¯·æ±‚å‚æ•°
 *  @param resultClass  éœ€è¦è½¬æ¢è¿”å›çš„æ•°æ®æ¨¡å‹
 *  @param success      è¯·æ±‚æˆåŠŸåçš„å›è°ƒï¼ˆè¯·å°†è¯·æ±‚æˆåŠŸåæƒ³åšçš„äº‹æƒ…å†™åˆ°è¿™ä¸ªblockä¸­ï¼‰
 *  @param warn         è¯·æ±‚å¤±è´¥åè­¦å‘Šæç¤ºè¯­ï¼ˆæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç›´æ¥å¼¹å‡ºæ˜¾ç¤ºå³å¯ï¼‰
 *  @param failure      è¯·æ±‚å¤±è´¥åçš„å›è°ƒï¼ˆè¯·å°†è¯·æ±‚å¤±è´¥åæƒ³åšçš„äº‹æƒ…å†™åˆ°è¿™ä¸ªblockä¸­ï¼‰
 *  @param tokenInvalid tokenè¿‡æœŸåçš„å›è°ƒï¼ˆè¯·å°†tokenåæƒ³åšçš„äº‹æƒ…å†™åˆ°è¿™ä¸ªblockä¸­ï¼‰
 */
- (void)postResultWithUrl:(NSString *)url param:(id)param
              resultClass:(Class)resultClass
                  success:(void (^)(id result))success
                     warn:(void (^)(NSString *warnMsg))warn
                  failure:(void (^)(NSError *error))failure
             tokenInvalid:(void (^)())tokenInvalid;

/**
 *  è¿”å›result æ•°æ®æ¨¡å‹
 */
- (void)postResultWithUrl:(NSString *)url param:(id)param
              resultClass:(Class)resultClass
                  success:(void (^)(id result))success
                     warn:(void (^)(NSString *warnMsg))warn
                  failure:(void (^)(NSError *error))failure
             tokenInvalid:(void (^)())tokenInvalid
{
    
    [self postBaseWithUrl:url param:param resultClass:resultClass
                  success:^(id responseObj) {
                      if (!resultClass) {
                          success(nil);
                          return;
                      }
                      success([resultClass mj_objectArrayWithKeyValuesArray:responseObj[@"result"]]);
                  }
                     warn:warn
                  failure:failure
             tokenInvalid:tokenInvalid];
}


/**
 *  æ•°æ®æ¨¡å‹åŸºç±»æ–¹æ³•
 */
- (void)postBaseWithUrl:(NSString *)url param:(id)param
            resultClass:(Class)resultClass
                success:(void (^)(id result))success
                   warn:(void (^)(NSString *warnMsg))warn
                failure:(void (^)(NSError *error))failure
           tokenInvalid:(void (^)())tokenInvalid
{
//    url = [NSString stringWithFormat:@"%@%@",Host,url];
    CYXLog(@"\nè¯·æ±‚é“¾æ¥åœ°å€---> %@",url);
    //çŠ¶æ€æ èŠèŠ±
    [UIApplication sharedApplication].networkActivityIndicatorVisible = YES;
    
    CYXHttpRequest *httpRequest = [[CYXHttpRequest alloc]init];
    
    [httpRequest post:url params:param success:^(id responseObj) {
        if (success) {
            NSDictionary *dictData = [NSJSONSerialization JSONObjectWithData:responseObj options:kNilOptions error:nil];
            CYXLog(@"è¯·æ±‚æˆåŠŸï¼Œè¿”å›æ•°æ® : %@",dictData);
            success(dictData);

        }
        //çŠ¶æ€æ èŠèŠ±
        [UIApplication sharedApplication].networkActivityIndicatorVisible = NO;
    } failure:^(NSError *error) {
        if (failure) {
            failure(error);
            CYXLog(@"è¯·æ±‚å¤±è´¥ï¼š%@",error);
        }
        //çŠ¶æ€æ èŠèŠ±
        [UIApplication sharedApplication].networkActivityIndicatorVisible = NO;
    }];
}


```