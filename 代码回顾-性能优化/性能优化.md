## 性能优化

其实整一个性能优化关键的点及流程有三个：

### 1.数据源的异步处理

**当我们获取到数据源的时候，我们需要对数据源进行计算处理，计算出UI绘制所需要的属性比如宽高、颜色等等，而且这些计算要异步去做，否则会卡住主线程**，等这些数据源计算完成之后，再去处理绘制，但是如果数据源过大，计算的耗时还是在的，所以会有较长时间的等待时间，此时我们需要考虑加上等待的友好处理

### 2.采用更轻量级的绘制

在**绘制时，对于不需要响应触摸事件的控件，我们应该尽量避免创建UIView对象，取而代之的是使用更为轻量的CALayer，并且对于一个layer包含多个subLayer的情况时，我们可以通过图层预合成的方法，将多个subLayer合成渲染成一张图片**，通过上述的处理，不仅能减少CPU在创建UIKit对象的消耗，还能减少GPU在合成和渲染上的消耗，内存的占用也会少很多

### 3.异步绘制

我们将使用`YYAsyncLayer`组件实现异步绘制



## TableView优化

![](http://oc98nass3.bkt.clouddn.com/15349205376557.jpg)


1.3 减少 cell 内部控件的层级
我们先来看一下一个带有原贴的转发贴的布局：

![](http://oc98nass3.bkt.clouddn.com/15349205601148.jpg)


2. 布局

可能有小伙伴会将上中下这三个部分各自封装成一个 view，再通过每个 view 来管理各自的子 view。但是这个框架的作者却将它们都排列到一层上。

减少了子 view 的层级，有助于减少 CPU 对各种约束的计算。这在子 view 的数量，层级都很多的情况下对 CPU 的压力会减轻很多。


1.4 通过覆盖圆角图片来实现头像的圆角效果

2.1 在 cellForRow: 方法里只加载可见 cell


## 参考

1. [IM UI性能优化之异步绘制 · 宫城](https://zeeyang.com/2016/07/05/IM-UI-optimize/)
2. [UITableView 优化：VVeboTableView 源码解析](https://mp.weixin.qq.com/s/4NvUj3lvEb85m8DIrzjoHw)
